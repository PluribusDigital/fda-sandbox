machine:
  python:
    version: 3.4.2
  services:
    - docker

dependencies:
  pre:
    # install aws command line tools for elasticbean stalk deployment
    - pip install awscli
    - sudo apt-get install nodejs; sudo apt-get install nodejs-legacy
    
  post:
    - bundle exec rake bower:install
    # build docker image
    - docker info
    #- docker build -t cjcassatt/openfda:$CIRCLE_SHA1 .
    # run docker containers
    # - docker run --name postgres -e POSTGRES_USER=$POSGRES_USER -e POSTGRES_PASSWORD=$POSTGRES_PASSWORD -d posgtres
    # - docker run --link postgres:postgres -it -d -p --name openfda cjcassat/openfda:$CIRCLE_SHA1
    # - if [ "$BUILD_POSTGRES_IMAGE" = "true"  ]; then docker commit postgres cjcassatt/openfda-postgres; fi

database:
  post:
    - bundle exec rake db:seed:
        environment:
          RAILS_ENV: test
          RACK_ENV: test

test:
  override:
    - bundle exec rspec:
        environment:
          RAILS_ENV: test
          RACK_ENV: test

#deployment:
#  demo:
#    branch: master
#    commands:
#      - bundle exec cap demo deploy
#  elasticbeanstalk:
#    branch: master
#    commands:
#    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
#    - bash deploy.sh $CIRCLE_SHA1 $POSTGRES_PASSWORD
