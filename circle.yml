machine:
  python:
    version: 2.7.3
  services:
    - docker

dependencies:
  pre:
    # install aws command line tools for elasticbean stalk deployment
    - pip install awscli
  post:
    - bundle exec rake bower:install
    # build docker image
    - docker info
    - docker build -t cjcassatt/openfda:$CIRCLE_SHA1 .

#database:
#  post:
#    - bundle exec rake pop

test:
  override:
    - bundle exec rspec

deployment:
#  demo:
#    branch: master
#    commands:
#      - bundle exec cap demo deploy
  elasticbeanstalk:
    branch: master
    commands:
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - bash deploy.sh $CIRCLE_SHA1 $POSTGRES_PASSWORD