machine:
  python:
    version: 3.4.2
  services:
    - docker

dependencies:
  pre:
    # install aws command line tools for elasticbean stalk deployment
    - pip install awscli
    # nodejs-legacy fails, why do we need this?
    # - sudo apt-get install nodejs-legacy
    # python setup
    - cd gruve && python setup.py develop

  post:
    - bundle exec rake bower:install
    - bash docker_build.sh:
        timeout: 1800

# skipping seed temporarily
#database:
#  post:
#    - bundle exec rake db:seed:
#        environment:
#          RAILS_ENV: test
#          RACK_ENV: test

#test:
#  override:
#   - bundle exec rspec -t smoke:
#       environment:
#         RAILS_ENV: test
#         RACK_ENV: test
#   - bundle exec rake teaspoon
#   - cd gruve && python setup.py test

deployment:
  elasticbeanstalk:
    branch: master
    commands:
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
    - bash docker_deploy.sh
