machine:
  python:
    version: 2.7.3
  services:
    - docker

dependencies:
  pre:
    # install aws command line tools for elasticbean stalk deployment
    - pip install awscli
  post:
    - bundle exec rake bower:install

#database:
#  post:
#    - bundle exec rake pop

test:
  override:
    - bundle exec rspec

deployment:
  #demo:
  #  branch: master
  #  commands:
  #    - bundle exec cap demo deploy
  elasticbeanstalk:
    branch: master
    commands:
      #- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      #- ./deploy.sh $CIRCLE_SHA1
      # getting permission errors running deploy script
      # running deploy scripts directly for now
      aws elasticbeanstalk create-application-version --application-name open-fda-dempo \
        --version-label $SHA1 --source-bundle S3Bucket=tsi-sandbox,S3Key=eb-docker-nginx-proxy.zip
      # Update Elastic Beanstalk environment to new version
      aws elasticbeanstalk update-environment --environment-name phpTestApp-stsi-env \
        --version-label $SHA1